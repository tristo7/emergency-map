<!DOCTYPE html>
<html>
  <head>
    <title>EM Map</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="EmergencyArea.css">
	<script src="jquery-3.1.1.min.js"></script>
  </head>
  <body>
		<h1>Emergency Management Map</h1>
		<div id="map"></div>
	<script type="text/javascript">
		function initMap() {
			var map = new google.maps.Map(document.getElementById('map'), {
			  center: {lat: 33.828640, lng: -85.763048},
			  zoom: 15
			});
			//load current polygons
			var results = $.getJSON("IO.php", function(result){
				//console.log(result);
				$.each(result, function(i, field){
					var color;
					switch(field.type){
						case "tornado":
							color = '#e6e600';
							break;
						case "fire":
							color = '#ff1a1a';
							break;
						case "road_hazard":
							color = '#3399ff';
							break;
						case "other":
							color = '#ff00ff';
							break;
					}
				
					//console.log(field.latLngArray);
					//console.log(field.expiration);
					//console.log(field.description);
					var paths = [];
					//console.log(JSON.parse(field.latLngArray));
					var tempPoly = new google.maps.Polygon({
						paths:JSON.parse(field.latLngArray),
						fillColor: color,
						fillOpacity: 0.35,
						strokeWeight: 1,
						strokeColor: '#ff0000'
					});
					
					
					tempPoly.setMap(map);
					addInfoWindow(tempPoly,field.expiration,field.description,field.type);
				});
			});
			
			
			
			function addInfoWindow(polygon, expir, desc, typ){
				var contentString = 
					'<div id="content">'+
					'<div id="siteNotice">'+
					'</div>'+
					'<h2>Expiration</h2>'+
					'<p>'+expir+''+
					'<h2>Description</h2>'+
					'<p>'+desc+''+
					'<h2>Type</h2>'+
					'<p>'+typ+''+
					'</div>';
				var info = new google.maps.InfoWindow({
					content: contentString
				});
				
				//generate infowindow when user clicks on the polygon.
				google.maps.event.addListener(polygon, 'click', function(event){
					info.setPosition(event.latLng);
					info.open(map);
				});
			}
		}
	</script>
	
	<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBgrYOrdmh3-jkJHk9ibXBrfQIeFAUPhak&libraries=drawing&callback=initMap">
    </script>
  </body>
</html>